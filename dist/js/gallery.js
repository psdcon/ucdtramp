var Gallery={init:function(){this.currentImageDbIndex=0,this.eventName=$("#gallery-event-name").val(),this.$hideBtn=$(".btn-showHide-form"),this.$eventLink=$(".swipebox-link"),this.$commentsPannel=$(".comments-pannel"),this.$commentsContainer=$(".comments-container"),this.$commentLoader=$(".comments-loading"),Gallery.$eventLink.swipebox({hideBarsDelay:3e3,beforeOpen:function(){Gallery.commentsPannelShow()},afterClose:function(){Gallery.commentsPannelHide()},loopAtEnd:!0}),this.bindUIActions()},bindUIActions:function(){this.$hideBtn.on("click",this.showHide),$(".comment-form").on("submit",this.commentPost)},urlMagic:function(e){this.currentImageDbIndex=Gallery.$eventLink.eq(e).data("photoid"),$("#current-image").text(e+1),this.commentsLoad();var t="gallery/"+this.eventName+"/"+(e+1);history.replaceState(null,null,t)},openImage:function(e){Gallery.$eventLink.eq(e-1).trigger("click")},showHide:function(){var e="Write Comment",t="Hide";$(this).text()==e?($(".comment-form-inputs").addClass("showForm"),$(".btn-comment").addClass("showForm"),$(this).addClass("showForm"),$(this).text(t)):($(".comment-form-inputs").removeClass("showForm"),$(".btn-comment").removeClass("showForm"),$(this).removeClass("showForm"),$(this).text(e))},commentsPannelShow:function(){this.$commentsPannel.addClass("show")},commentsPannelHide:function(){this.$commentsPannel.removeClass("show")},comment2HTML:function(e){var t=""!==e.special?"<div>"+e.special+"</div>":"";return"<div><strong>"+e.sender+'</strong><time style="float:right;" datetime="'+e.htmlDatetime+'" title="'+e.readableTime+'">'+e.niceTime+"</time></div>"+t+'<div style="padding-top:.4em;">'+e.message+"</div>"},commentsLoad:function(){$.ajax({type:"POST",url:"gallery.ajax.php",data:"action=getComments&photoid="+Gallery.currentImageDbIndex+"&eventname="+Gallery.eventName,dataType:"json",success:function(e){if(e.empty)Gallery.$commentsContainer.text("No comments :(");else if(e.comments){for(var t="",n=0;n<e.comments.length;n++)t+=Gallery.comment2HTML(e.comments[n]);var o=Gallery.$commentsContainer.html(t);o.find("time").timeago()}else console.log(e)},error:function(e,t,n){console.log(e.responseText)}})},commentPost:function(){var e=$(".comment-user").val(),t=$(".comment-message").val();return""===e||""===t?(alert("Fill the text boxes"),!1):($.ajax({type:"POST",url:"gallery.ajax.php",data:"action=addComment&sender="+e+"&message="+t+"&photoid="+Gallery.currentImageDbIndex+"&eventname="+Gallery.eventName,dataType:"json",success:function(e){e.newComment?($(".comment-message").val(""),Gallery.$commentsContainer.html(Gallery.comment2HTML(e.newComment))):console.log(e)},error:function(e,t,n){console.log(e.responseText)}}),!1)}};Gallery.init();