function populateSelects(){for(var e,l="",t=1;t<skills.length-1;t++)skills[t][0]!=e&&0!==t&&(l+='<optgroup label="'+skills[t][0]+'">',e=skills[t][0]),l+='<option value="'+t+'" title="Description...">'+skills[t][1]+"</option>";$(".skillSelect").append(l)}function shapeRemove(e){if(""!==shapeArray[e]&&lastSkillChange-new Date<-20){var l=$(".skillSelect").eq(e).children("optgroup").children(),t=selectedSkillsArray[e];console.log("Removing shape from "+l.eq(t).html()),l.eq(t-1).html(skills[t][1])}}function skillChange(e,l){return shapeRemove(l),lastSkillChange=new Date,selectedSkillsArray[l]="0"==e?"":e,$(".tariff").eq(l).text(skills[e][6]),$(".saltos").eq(l).text(skills[e][7][0]),$(".twists").eq(l).text(skills[e][7][1]),$(".FIGShape").eq(l).text(skills[e][7][2]),"1"==skills[e][2]?($(".shapeForm").eq(l).children().removeAttr("disabled"),$(".shapeForm").eq(l).children().eq(0).attr("checked",!0),void shapeChange("Tuck",l)):($(".shapeForm").eq(l).children().attr("disabled",!0),$(".shapeForm").eq(l).children().attr("checked",!1),shapeArray[l]="",checkOK(),void total())}function shapeChange(e,l){var t=selectedSkillsArray[l];shapeArray[l]=e,$(".skillSelect option:selected").eq(l).html(skills[t][1]+" ("+e+")"),"Tuck"!=e?(bonusTariff=parseFloat(skills[t][6])+parseFloat(skills[t][3]),$(".tariff").eq(l).text(Math.round(10*bonusTariff)/10),"Pike"==e?$(".FIGShape").eq(l).text("<"):"Straight"==e&&$(".FIGShape").eq(l).text("/")):($(".tariff").eq(l).text(skills[t][6]),$(".FIGShape").eq(l).text("o")),checkOK(),total()}function checkOK(){if($("#repeats").text("").hide(),$("#invalidLinks").text("").hide(),repeatsOK=!0,linksOK=!0,$(".skillSelect").each(function(e){""===selectedSkillsArray[e]?$(this).css("border-color","#CCC"):($(this).css("border-color","green"),""===shapeArray[e]||"Tuck"==shapeArray[e]?$(".tariff").eq(e).text(skills[selectedSkillsArray[e]][6]):(bonusTariff=parseFloat(skills[selectedSkillsArray[e]][6])+parseFloat(skills[selectedSkillsArray[e]][3]),$(".tariff").eq(e).text(Math.round(10*bonusTariff)/10))),$(".tariff").eq(e).css("border-color","#CCC")}),$(".skillSelect").each(function(e){for(var l=e+1;10>l&&""!==selectedSkillsArray[e];l++){if(selectedSkillsArray[e]==selectedSkillsArray[l]){var t=$("#repeats").html();""!==shapeArray[e]&&shapeArray[e]==shapeArray[l]?($(".skillSelect").eq(e).css("border-color","red"),$(".skillSelect").eq(l).css("border-color","red"),$(".tariff").eq(l).css("border-color","red").text("Rpt"),t+="The shape for skill "+(e+1)+" and "+(l+1)+" is the same<br>",repeatsOK=!1):""===shapeArray[e]&&($(".skillSelect").eq(e).css("border-color","red"),$(".skillSelect").eq(l).css("border-color","red"),$(".tariff").eq(l).css("border-color","red").text("Rpt"),t+="Skills "+(e+1)+" and "+(l+1)+" are the same<br>",repeatsOK=!1),$("#repeats").html(t);break}"Front Drop"==skills[selectedSkillsArray[e]][1]&&""!==selectedSkillsArray[l]&&"&frac12; Twist to Front Drop"==skills[selectedSkillsArray[l]][1]&&$("#easter").show("slow")}}),!repeatsOK){var e=$("#repeats").html();e+="<br><span style='font-size:0.8em;'>Repeats only allowed in <strong>Voluntary</strong> routines.<br> No tariff is awarded for repeated skill</span>",$("#repeats").html(e).show()}if($(".skillSelect").each(function(e){if(9>e&&""!==selectedSkillsArray[e]&&""!==selectedSkillsArray[e+1]&&skills[selectedSkillsArray[e]][5]!=skills[selectedSkillsArray[e+1]][4]){$(".skillSelect").eq(e).css("border-color","orange"),$(".skillSelect").eq(e+1).css("border-color","orange");var l=$("#invalidLinks").html();l+="Skill "+(e+1)+" ends in "+skills[selectedSkillsArray[e]][5]+" but skill "+(e+2)+" starts from "+skills[selectedSkillsArray[e+1]][4]+"<br>",$("#invalidLinks").html(l).show(),linksOK=!1}}),""!==selectedSkillsArray[9]&&"feet"!=skills[selectedSkillsArray[9]][5]){$(".skillSelect").eq(9).css("border-color","orange");var l=$("#invalidLinks").html();l+="The last skill must end in feet, not "+skills[selectedSkillsArray[9]][5]+"<br>",$("#invalidLinks").html(l).show(),linksOK=!1}}function routineChange(){var e=$("#routineSelect").val(),l=new RegExp("(Tuck|Pike|Straight)"),t=!1;if("0"==e)$(".skillSelect").each(function(e){$(this).val(0),skillChange(0,e)});else for(var r,s="",i=0;10>i;i++,t=!1){r=routines[e][i+3].search(/ \((Tuck|Pike|Straight)/gi),s=r>0?routines[e][i+3].substring(0,r):routines[e][i+3];for(var a=1;a<skills.length-1;a++)if(s==skills[a][1]){if($(".skillSelect").eq(i).val(a),skillChange(a,i),"1"==skills[a][2]){var o=l.exec(routines[e][i+3]);"Pike"==o[1]?$(".shapeForm").eq(i).children().eq(1).attr("checked",!0):"Straight"==o[1]&&$(".shapeForm").eq(i).children().eq(2).attr("checked",!0),shapeChange(o[1],i)}t=!0;break}t||alert("Skill "+(i+1)+" '"+routines[e][i+3]+"' was NOT found")}}function total(){var e=0;$(".tariff").each(function(){var l=$(this).text();""!==l&&"Rpt"!=l&&(e+=parseFloat(l))}),e=Math.round(10*e)/10,$("#total").text(e>0?e:"")}function showFIG(){var e=document.getElementById("showFIG").children[0];e.checked===!0?($(".FIG").show("slow").css("display","inline-block"),$("#FIGHeader").show("slow").css("top","0"),$("#error").css("width","34%")):($(".FIG").hide("slow"),$("#FIGHeader").hide("slow"),$("#error").css("width","48%"))}function compChange(){var e=$("#compSelect").val(),l=$("#levelSelect label");"Free"!=e?($("#routineSelectPlaceholder").fadeOut("fast",function(){$("#routineSelect").fadeIn()}),populateRoutineSelect(!1),l.each(function(){"Intervanced"!=$(this).text()||"Regionals"!=e&&"In-House"!=e?$(this).fadeIn():$(this).hide("fast")})):(l.fadeOut(),$("#routineSelect").fadeOut(function(){$("#routineSelectPlaceholder").fadeIn()})),$("#levelSelect label").children(":radio").attr("checked",!1)}function populateRoutineSelect(e){var t,r=$("#compSelect").val(),s=0,i='"<option value="0"></option>';if(e&&r)for(t=1,l=routines.length-1;t<l;t++)routines[t][0]==e&&routines[t][1]==r&&(i+='<option value="'+t+'">'+routines[t][0]+" - "+routines[t][2]+"</option>",s++);else if(!e){var a="";for(t=1;t<routines.length-1;t++)routines[t][1]==r&&(a!=routines[t][0]&&(i+='<optgroup label="'+routines[t][0]+'">',a=routines[t][0]),i+='<option value="'+t+'">'+routines[t][2]+"</option>",s++)}$("#routineSelect").html(i);var o=0===s?"No Routines yet...":"Sample Routines... ("+s+")";$("#routineSelect").children().eq(0).text(o)}function saveRoutine(){errTxt="Your routine can't be saved until:",linksOK===!1&&(errTxt+="\n- All links are valid");for(var e=!0,l=0;10>l;l++)""===selectedSkillsArray[l]&&(e=!1);e===!1&&(errTxt+="\n- All 10 skills are selected");var t,r=$("#compSelect option:selected");""!==r.val()?t=r.text():errTxt+="\n- A competition is selected";var s,i=$('#levelSelect input[type="radio"]:checked');if(i.length>0?s=i.val():errTxt+="\n- A difficult level is selected","Your routine can't be saved until:"!=errTxt)alert(errTxt);else{var a=prompt("Please enter a name for this routine. \nFor example: 20YY - Front/Back");if(null===a)return!1;for(l=0;10>l;l++,str+=skills[selectedSkillsArray[l]][1])str+=""!==shapeArray[l]?" ("+shapeArray[l]+"),":",";var o=encodeURIComponent(str);$.ajax({type:"GET",url:"/newer_tariff.php",data:"name="+a+"&comp="+t+"&level="+s+"&routine="+o,dataType:"text",success:function(e){alert(e)}})}}var shapeArray=new Array("","","","","","","","","",""),selectedSkillsArray=new Array("","","","","","","","","","");populateSelects();var lastSkillChange=new Date,repeatsOK=!0,linksOK=!0;$("#levelSelect input").click(function(){populateRoutineSelect(this.value)});